<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>自动升级URL by newbdez33</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>自动升级URL</h1>
        <p>生成一个可以直接交给API的自动升级URL</p>

        <p class="view"><a href="https://github.com/newbdez33/brotherhood">View the Project on GitHub <small>newbdez33/brotherhood</small></a></p>


        <ul>
          <li><a href="https://github.com/newbdez33/brotherhood/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/newbdez33/brotherhood/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/newbdez33/brotherhood">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h3>
<a name="%E9%9C%80%E8%A6%81%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8" class="anchor" href="#%E9%9C%80%E8%A6%81%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%97%E8%A1%A8"><span class="octicon octicon-link"></span></a>需要的文件列表</h3>

<p>每次自动更新功能需要提供以下几个文件:</p>

<ol>
<li>iTunesArtwork.png  (512x512 大图标)</li>
<li>icon.png (57x57 app图标) </li>
<li>CRMSalesManager-1.0.0.ipa (APP安装文件)</li>
<li>CRMSalesManager-1.0.0.plist (plist配置文件)</li>
</ol><p>其中，iTunesArtwork.png和icon.png都是app的图标，为png格式。 
CRMSalesManager-1.0.0.ipa是app打好的安装包，后面的版本为当前的app的版本，比如最新版是v1.0.11则文件名就是：</p>

<ul>
<li>CRMSalesManager-1.0.11.ipa</li>
</ul><p>而plist配置文件的内容是由1,2,3组成的。</p>

<h3>
<a name="plist%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-crmsalesmanager-100plist" class="anchor" href="#plist%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-crmsalesmanager-100plist"><span class="octicon octicon-link"></span></a>plist配置文件 CRMSalesManager-1.0.0.plist</h3>

<p>该文件是一个XML文件，我们只要替换相应的文件URL即可。 
内容为以下：</p>

<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;!-- http://itms-services://?action=download-manifest&amp;url=http://192.168.1.159/public/server/php/files/CRMSalesManager-1.0.0.plist --&gt;
&lt;dict&gt;
   &lt;key&gt;items&lt;/key&gt;
   &lt;array&gt;
       &lt;dict&gt;
           &lt;key&gt;assets&lt;/key&gt;
           &lt;array&gt;
               &lt;dict&gt;
                   &lt;key&gt;kind&lt;/key&gt;
                   &lt;string&gt;software-package&lt;/string&gt;
                   &lt;key&gt;url&lt;/key&gt;
                   &lt;string&gt;http://192.168.1.159/public/server/php/files/CRMSalesManager-1.0.0.ipa&lt;/string&gt;
               &lt;/dict&gt;
               &lt;dict&gt;
                   &lt;key&gt;kind&lt;/key&gt;
                   &lt;string&gt;display-image&lt;/string&gt;
                   &lt;key&gt;needs-shine&lt;/key&gt;
                   &lt;true/&gt;
                   &lt;key&gt;url&lt;/key&gt;
                   &lt;string&gt;http://192.168.1.159/public/server/php/files/icon.png&lt;/string&gt;
               &lt;/dict&gt;
           &lt;dict&gt;
                   &lt;key&gt;kind&lt;/key&gt;a/string&gt;
                   &lt;key&gt;needs-shine&lt;/key&gt;
                   &lt;true/&gt;
                   &lt;key&gt;url&lt;/key&gt;
                   &lt;string&gt;http://192.168.1.159/public/server/php/files/iTunesArtwork.png&lt;/string&gt;
               &lt;/dict&gt;
           &lt;/array&gt;
           &lt;key&gt;metadata&lt;/key&gt;
           &lt;dict&gt;
               &lt;key&gt;bundle-identifier&lt;/key&gt;
               &lt;string&gt;com.samlonapps.CRMSalesManager&lt;/string&gt;
               &lt;key&gt;bundle-version&lt;/key&gt;
               &lt;string&gt;1.0.0&lt;/string&gt;
               &lt;key&gt;kind&lt;/key&gt;
               &lt;string&gt;software&lt;/string&gt;
               &lt;key&gt;subtitle&lt;/key&gt;
               &lt;string&gt;CRMSalesManager&lt;/string&gt;
               &lt;key&gt;title&lt;/key&gt;
               &lt;string&gt;CRMSalesManager&lt;/string&gt;
           &lt;/dict&gt;
       &lt;/dict&gt;
   &lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>

<p>=== 通知API端更新URL
根据当前的版本号，更新API返回的版本字符串，以及URL。
URL格式为： </p>

<pre><code>itms-services://?action=download-manifest&amp;url=http://192.168.1.159/public/server/php/files/CRMSalesManager-1.0.0.plist
</code></pre>

<p>注意修改后面 </p>

<ul>
<li>
<a href="http://192.168.1.159">http://192.168.1.159</a> 为Web服务器ip或域名</li>
<li>/public/server/php/files/CRMSalesManager-1.0.0.plist 为plist文件在Web服务器上的路径 </li>
</ul><p>这样iOS会载入该URL，并根据plist配置文件来安装对应版本的ipa安装包了。</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/newbdez33">newbdez33</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>